<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Car Price Predictor</title>
  <style>
    /* ====== Base / Layout ====== */
    :root{
      --bg1: #0f172a;
      --card: #ffffff;
      --accent: #06b6d4;
      --accent-2: #7c3aed;
      --muted: #6b7280;
      --glass: rgba(255,255,255,0.06);
    }
    *{box-sizing:border-box;font-family:Inter,ui-sans-serif,system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial}
    body{
      margin:0;
      min-height:100vh;
      background:
        linear-gradient(180deg, rgba(6,11,45,0.82), rgba(5,10,25,0.9)),
        url('static/download.jpg');
        
      background-size:cover;
      background-position:center;
      color:#e6eef8;
      display:flex;
      align-items:center;
      justify-content:center;
      padding:40px;
    }

    .wrap {
      width:100%;
      max-width:1100px;
      display:grid;
      grid-template-columns: 420px 1fr;
      gap:28px;
      align-items:start;
    }

    /* ====== Left card (form) ====== */
    .card {
      background: linear-gradient(180deg, rgba(255,255,255,0.03), rgba(255,255,255,0.02));
      border-radius:16px;
      padding:24px;
      box-shadow: 0 6px 30px rgba(2,6,23,0.6);
      backdrop-filter: blur(6px);
      border: 1px solid rgba(255,255,255,0.04);
    }

    h1{ margin:0 0 8px 0; font-size:20px; color: #fff; }
    p.lead{ margin:0 0 18px 0; color:var(--muted); font-size:14px }

    form{
      display:grid;
      gap:12px;
      grid-auto-rows:min-content;
    }

    .row{
      display:flex;
      gap:12px;
    }
    .col{ flex:1; }

    label{
      font-size:12px;
      color:#cbd5e1;
      display:block;
      margin-bottom:6px;
    }
    input[type="number"], select{
      width:100%;
      padding:10px 12px;
      border-radius:10px;
      border:1px solid rgba(255,255,255,0.06);
      background: rgba(255,255,255,0.02);
      color: #f8fafc;
      font-size:14px;
      outline:none;
      transition: box-shadow .18s, transform .12s;
    }
    input[type="number"]:focus, select:focus{
      box-shadow: 0 6px 18px rgba(7,89,133,0.12);
      transform: translateY(-1px);
      border-color: rgba(6,182,212,0.9);
    }
    .note{ font-size:12px; color:#9aa7bb; margin-top:6px; }

    /* buttons */
    .btn{
      display:inline-flex;
      align-items:center;
      justify-content:center;
      gap:10px;
      padding:10px 14px;
      border-radius:12px;
      cursor:pointer;
      border: none;
      font-weight:600;
      font-size:15px;
      background: linear-gradient(90deg,var(--accent),var(--accent-2));
      color:white;
      box-shadow: 0 8px 24px rgba(124,58,237,0.16);
      transition: transform .12s, box-shadow .12s;
    }
    .btn:hover{ transform: translateY(-3px); box-shadow: 0 16px 36px rgba(124,58,237,0.2); }
    .btn:disabled{ opacity:0.6; transform:none; cursor:not-allowed; }

    .secondary{
      background: transparent;
      border:1px solid rgba(255,255,255,0.06);
      color:#e6eef8;
    }

    .small { font-size:13px; padding:8px 10px; border-radius:10px; }

    .error{ color: #ffb4b4; font-size:13px; margin-top:6px; display:none; }

    /* ====== Right: result / info ====== */
    .result-area{
      display:flex;
      flex-direction:column;
      gap:18px;
    }
    .result-card{
      background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
      border-radius:16px;
      padding:24px;
      min-height:240px;
      border:1px solid rgba(255,255,255,0.03);
      position:relative;
      overflow:hidden;
    }
    .result-title{ color:#cfefff; font-size:15px; margin:0 0 6px 0; }
    .result-sub{ color:var(--muted); font-size:13px; margin:0 0 20px 0; }

    .price{
      font-size:36px;
      font-weight:700;
      color:#fff;
      letter-spacing:0.5px;
    }

    /* Magical reveal animation */
    .magic {
      transform-origin:center;
      animation: popIn .8s cubic-bezier(.2,.9,.25,1) forwards;
    }
    @keyframes popIn{
      0%{ transform: scale(.7); opacity:0; filter: blur(8px) }
      60%{ transform: scale(1.05); opacity:1; filter: blur(0) }
      100%{ transform: scale(1); filter: none }
    }
    .glow{
      position:absolute;
      right:-80px;
      top:-40px;
      width:320px;height:320px;
      background: radial-gradient(circle at 30% 30%, rgba(7,196,216,0.14), rgba(124,58,237,0.06) 40%, transparent 60%);
      filter: blur(28px);
      pointer-events:none;
      transform: rotate(12deg);
    }

    /* simple particle (spark) */
    .spark{
      position:absolute;
      left:10%;
      top:12%;
      width:6px;height:6px;
      background: linear-gradient(180deg,#fff, #ffd700);
      border-radius:50%;
      opacity:0;
      transform: translateY(0) scale(.6);
      animation: sparkAnim 1.2s ease-out forwards;
      pointer-events:none;
    }
    @keyframes sparkAnim{
      0%{ opacity:1; transform: translateY(0) scale(.6) }
      100%{ opacity:0; transform: translateY(-90px) scale(1.4) }
    }

    /* responsive */
    @media (max-width:980px){
      .wrap{ grid-template-columns: 1fr; padding:10px; }
      .card{ order:2; }
    }

    /* tiny helpers */
    .muted { color:var(--muted); font-size:13px; }
    .flex { display:flex; gap:8px; align-items:center; }
  </style>
</head>
<body>
  <div class="wrap">

    <!-- LEFT: Form -->
    <div class="card">
      <h1>Car Price Predictor</h1>
      <p class="lead">Fill the car details below. Inputs that cannot be negative are validated. Use dropdowns where available.</p>

      <form id="car-form" autocomplete="off">
        <!-- row 1 -->
        <div class="row">
          <div class="col">
            <label for="fuel-type">Fuel Type</label>
            <select id="fuel-type" name="fuel-type" required>
              <option value="gas">Gas</option>
              <option value="diesel">Diesel</option>
            </select>
          </div>
          <div class="col">
            <label for="aspiration">Aspiration</label>
            <select id="aspiration" name="aspiration" required>
              <option value="std">Standard</option>
              <option value="turbo">Turbo</option>
            </select>
          </div>
        </div>

        <!-- row 2 -->
        <div class="row">
          <div class="col">
            <label for="wheel-base">Wheel Base (inches)</label>
            <input id="wheel-base" name="wheel-base" type="number" step="0.1" min="0" required>
          </div>
          <div class="col">
            <label for="length">Length (inches)</label>
            <input id="length" name="length" type="number" step="0.1" min="0" required>
          </div>
        </div>

        <!-- row 3 -->
        <div class="row">
          <div class="col">
            <label for="width">Width (inches)</label>
            <input id="width" name="width" type="number" step="0.1" min="0" required>
          </div>
          <div class="col">
            <label for="height">Height (inches)</label>
            <input id="height" name="height" type="number" step="0.1" min="0" required>
          </div>
        </div>

        <!-- row 4 -->
        <div class="row">
          <div class="col">
            <label for="curb-weight">Curb Weight (lbs)</label>
            <input id="curb-weight" name="curb-weight" type="number" step="1" min="0" required>
          </div>
          <div class="col">
            <label for="engine-size">Engine Size (cc)</label>
            <input id="engine-size" name="engine-size" type="number" step="1" min="0" required>
          </div>
        </div>

        <!-- row 5 -->
        <div class="row">
          <div class="col">
            <label for="bore">Bore (inches)</label>
            <input id="bore" name="bore" type="number" step="0.01" min="0" required>
          </div>
          <div class="col">
            <label for="stroke">Stroke (inches)</label>
            <input id="stroke" name="stroke" type="number" step="0.01" min="0" required>
          </div>
        </div>

        <!-- row 6 -->
        <div class="row">
          <div class="col">
            <label for="compression-ratio">Compression Ratio</label>
            <input id="compression-ratio" name="compression-ratio" type="number" step="0.01" min="0" required>
          </div>
          <div class="col">
            <label for="horsepower">Horsepower</label>
            <input id="horsepower" name="horsepower" type="number" step="1" min="0" required>
          </div>
        </div>

        <!-- row 7 -->
        <div class="row">
          <div class="col">
            <label for="peak-rpm">Peak RPM</label>
            <input id="peak-rpm" name="peak-rpm" type="number" step="1" min="0" required>
          </div>
          <div class="col">
            <label for="city-mpg">City MPG</label>
            <input id="city-mpg" name="city-mpg" type="number" step="0.1" min="0" required>
          </div>
        </div>

        <!-- row 8: ordinal cylinders -->
        <div class="row">
          <div class="col">
            <label for="num-of-cylinders">Num of Cylinders</label>
            <select id="num-of-cylinders" name="num-of-cylinders" required>
              <option value="two">Two</option>
              <option value="three">Three</option>
              <option value="four" selected>Four</option>
              <option value="five">Five</option>
              <option value="six">Six</option>
              <option value="eight">Eight</option>
              <option value="twelve">Twelve</option>
            </select>
          </div>

          <div class="col">
            <label for="make">Make</label>
            <select id="make" name="make" required>
              <!-- prefer list from your training file -->
              <option value="toyota">Toyota</option>
              <option value="bmw">BMW</option>
              <option value="audi">Audi</option>
              <option value="honda">Honda</option>
              <option value="ford">Ford</option>
              <option value="nissan">Nissan</option>
              <option value="mazda">Mazda</option>
              <option value="volkswagen">Volkswagen</option>
              <option value="mercedes-benz">Mercedes-Benz</option>
              <option value="volvo">Volvo</option>
              <option value="chevrolet">Chevrolet</option>
              <option value="mitsubishi">Mitsubishi</option>
              <option value="peugeot">Peugeot</option>
              <option value="porsche">Porsche</option>
              <option value="jaguar">Jaguar</option>
              <option value="saab">Saab</option>
              <option value="subaru">Subaru</option>
              <option value="dodge">Dodge</option>
              <option value="isuzu">Isuzu</option>
              <option value="mercury">Mercury</option>
              <option value="plymouth">Plymouth</option>
              <option value="renault">Renault</option>
            </select>
          </div>
        </div>

        <!-- row 9: body style, drive, engine-type -->
        <div class="row">
          <div class="col">
            <label for="body-style">Body Style</label>
            <select id="body-style" name="body-style" required>
              <option value="sedan">Sedan</option>
              <option value="hatchback">Hatchback</option>
              <option value="wagon">Wagon</option>
              <option value="convertible">Convertible</option>
              <option value="hardtop">Hardtop</option>
            </select>
          </div>

          <div class="col">
            <label for="drive-wheels">Drive Wheels</label>
            <select id="drive-wheels" name="drive-wheels" required>
              <option value="fwd">FWD</option>
              <option value="rwd">RWD</option>
              <option value="4wd">4WD</option>
            </select>
          </div>
        </div>

        <div class="row">
          <div class="col">
            <label for="engine-type">Engine Type</label>
            <select id="engine-type" name="engine-type" required>
              <option value="ohc">ohc</option>
              <option value="ohcf">ohcf</option>
              <option value="ohcv">ohcv</option>
              <option value="dohc">dohc</option>
              <option value="dohcv">dohcv</option>
              <option value="l">l</option>
              <option value="rotor">rotor</option>
            </select>
          </div>
          <div class="col" style="display:flex;align-items:flex-end;justify-content:flex-end">
            <div style="text-align:right">
              <div class="note">All numeric inputs must be ≥ 0. Invalid inputs will be highlighted.</div>
              <div style="height:8px;"></div>
              <button id="predict-btn" type="button" class="btn">Predict Price</button>
            </div>
          </div>
        </div>

        <div id="form-error" class="error">Please fix highlighted fields.</div>

      </form>
    </div>

    <!-- RIGHT: Result -->
    <div class="result-area">
      <div class="result-card" id="resultCard" aria-live="polite">
        <div class="glow"></div>

        <div id="resultContent">
          <p class="result-title">Prediction</p>
          <p class="result-sub">The predicted selling price will appear here after you click <strong>Predict Price</strong>.</p>

          <div style="display:flex;align-items:center;gap:16px;">
            <div style="flex:1">
              <div class="muted">Estimated Price</div>
              <div class="price" id="predPrice">—</div>
            </div>
            <div style="text-align:right">
              <div class="muted">Status</div>
              <div id="predStatus" class="muted">Waiting</div>
            </div>
          </div>
        </div>

      </div>

      <div class="card" style="padding:16px;">
        <h3 style="margin:0 0 8px 0;">Tips</h3>
        <ul style="margin:0 0 12px 18px; color:var(--muted)">
          <li>Make sure your Flask API is running and accessible at <code>/predict</code>.</li>
          <li>All fields are required.</li>
          <li>Values that cannot be negative will be blocked by the form.</li>
        </ul>
        <div style="display:flex;gap:8px;flex-wrap:wrap;">
          <button id="reset-btn" class="btn secondary small">Reset Form</button>
          <button id="sample-btn" class="btn small">Fill Sample</button>
        </div>
      </div>
    </div>
  </div>

  <script>
    // --------------------
    // Helpers & Validation
    // --------------------
    const form = document.getElementById('car-form');
    const predictBtn = document.getElementById('predict-btn');
    const resultPrice = document.getElementById('predPrice');
    const resultStatus = document.getElementById('predStatus');
    const resultCard = document.getElementById('resultCard');
    const formError = document.getElementById('form-error');
    const resetBtn = document.getElementById('reset-btn');
    const sampleBtn = document.getElementById('sample-btn');

    // list of numeric fields to validate non-negative
    const numericFields = [
      'wheel-base','length','width','height','curb-weight','engine-size',
      'bore','stroke','compression-ratio','horsepower','peak-rpm','city-mpg'
    ];

    // Ensure numeric inputs cannot be negative (extra guard)
    numericFields.forEach(name => {
      const el = document.getElementsByName(name)[0];
      if(!el) return;
      el.addEventListener('input', () => {
        if(el.value === '') return;
        const v = parseFloat(el.value);
        if(isNaN(v) || v < 0){
          el.value = '';
          showFieldError(el, "Value must be ≥ 0");
        } else {
          clearFieldError(el);
        }
      });
    });

    function showFieldError(el, message) {
      el.style.borderColor = '#ff7b7b';
      formError.style.display = 'block';
    }
    function clearFieldError(el){
      el.style.borderColor = '';
      // hide form error only if no fields invalid
      const invalid = [...form.elements].some(e => e.tagName !== 'BUTTON' && e.willValidate && !e.checkValidity());
      if(!invalid) formError.style.display = 'none';
    }

    // create JSON payload matching your Flask preprocess_input keys (hyphen keys included)
    function buildPayload() {
      const d = {};
      // simple string/select fields
      const keys = [
        'fuel-type','aspiration','wheel-base','length','width','height','curb-weight',
        'engine-size','bore','stroke','compression-ratio','horsepower','peak-rpm','city-mpg',
        'num-of-cylinders','make','body-style','drive-wheels','engine-type'
      ];
      keys.forEach(k => {
        const el = document.getElementsByName(k)[0];
        if(!el) return;
        // numeric types to numbers
        if(el.type === 'number') d[k] = (el.value === '' ? null : Number(el.value));
        else d[k] = el.value;
      });
      return d;
    }

    // show magic result
    function showMagic(price){
      // small sparkle elements
      for(let i=0;i<10;i++){
        const s = document.createElement('div');
        s.className = 'spark';
        s.style.left = (10 + Math.random()*80) + '%';
        s.style.top = (10 + Math.random()*60) + '%';
        s.style.animationDelay = (Math.random()*0.3)+'s';
        resultCard.appendChild(s);
        setTimeout(()=> s.remove(), 1400);
      }

      // animate card
      resultCard.classList.add('magic');
      setTimeout(()=> resultCard.classList.remove('magic'), 900);

      resultPrice.innerText = (Math.round(price*100)/100).toLocaleString('en-US', {minimumFractionDigits:2, maximumFractionDigits:2});
      resultStatus.innerText = 'Success';
    }

    // --------------------
    // Event: Predict
    // --------------------
    predictBtn.addEventListener('click', async () => {
      // HTML validity check
      if(!form.checkValidity()){
        form.reportValidity();
        formError.style.display = 'block';
        return;
      }

      // build payload
      const payload = buildPayload();

      // final guard: ensure numeric fields exist and are >=0
      for(const n of numericFields){
        if(payload[n] === null || payload[n] === undefined || isNaN(payload[n])){
          alert('Please enter a valid number for ' + n);
          return;
        }
        if(Number(payload[n]) < 0){
          alert('Negative values are not allowed for ' + n);
          return;
        }
      }

      // disable button
      predictBtn.disabled = true;
      predictBtn.innerText = 'Predicting...';
      resultStatus.innerText = 'Predicting...';

      try{
        // send request to Flask endpoint (same origin). If your Flask is on different host,
        // update the URL to e.g. 'http://localhost:5000/predict'
        const res = await fetch('/predict', {
          method: 'POST',
          headers: {'Content-Type':'application/json'},
          body: JSON.stringify(payload)
        });

        if(!res.ok){
          // try parse error JSON
          const txt = await res.text();
          throw new Error('Server response: '+ txt);
        }

        const data = await res.json();

        if(data.status && data.status === 'success'){
          const price = Number(data.predicted_price);
          showMagic(price);
        } else {
          throw new Error(data.message || 'Unknown error from API');
        }

      } catch (err){
        console.error(err);
        resultStatus.innerText = 'Error';
        alert('Prediction failed: ' + err.message);
      } finally {
        predictBtn.disabled = false;
        predictBtn.innerText = 'Predict Price';
      }
    });

    // --------------------
    // Utility buttons
    // --------------------
    resetBtn.addEventListener('click', () => {
      form.reset();
      resultPrice.innerText = '—';
      resultStatus.innerText = 'Waiting';
      formError.style.display = 'none';
    });

    sampleBtn.addEventListener('click', () => {
      // a reasonable sample
      document.getElementById('fuel-type').value = 'gas';
      document.getElementById('aspiration').value = 'std';
      document.getElementById('wheel-base').value = 98.7;
      document.getElementById('length').value = 173.6;
      document.getElementById('width').value = 65.2;
      document.getElementById('height').value = 54.5;
      document.getElementById('curb-weight').value = 2548;
      document.getElementById('engine-size').value = 122;
      document.getElementById('bore').value = 3.47;
      document.getElementById('stroke').value = 2.68;
      document.getElementById('compression-ratio').value = 9.0;
      document.getElementById('horsepower').value = 88;
      document.getElementById('peak-rpm').value = 5000;
      document.getElementById('city-mpg').value = 25;
      document.getElementById('num-of-cylinders').value = 'four';
      document.getElementById('make').value = 'toyota';
      document.getElementById('body-style').value = 'sedan';
      document.getElementById('drive-wheels').value = 'fwd';
      document.getElementById('engine-type').value = 'ohc';
    });

    // small accessibility: press Enter on any input triggers predict
    form.addEventListener('keypress', (e) => {
      if(e.key === 'Enter'){
        e.preventDefault();
        predictBtn.click();
      }
    });

  </script>
</body>
</html>
